<span uk-spinner="ratio: 1.5"  class="uk-flex-center" style="position: fixed;" *ngIf="isLoading" ></span>




<section [hidden]="windowMode != 'grid'">
    <div class="uk-flex uk-flex-right@m uk-flex-right@l uk-text-middle uk-margin">
        <a href="#" uk-icon="icon: search" uk-toggle="target: #toggle-usage"  class="uk-button uk-button-default"></a> &nbsp;
        <a (click)="getDataApprovalDoc()" uk-icon="icon: refresh" class="uk-button uk-button-default"></a> &nbsp;
        <a  uk-icon="icon: plus" uk-toggle="target: #toggle-breadcrumb"  class="uk-button uk-button-primary text-light" [hidden]="windowMode!='grid'" (click)="windowModeView('create')" >Create &nbsp;</a>
    </div> 
    
    
    
    
    <div class="card mb-4" id="toggle-usage">
        <div class="card-body">
            <div>
                <div  class="uk-margin-small row" >
    
                    <div class="col-md-6">
                        <label class="uk-form-label mt-2" for="form-stacked-text">No. Surat Approval</label>
                        <div class="uk-form-controls">
                            <input class="uk-input " type="text" [(ngModel)]="filterData.noDokumen" placeholder="Nomor Dokumen Approval">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label class="uk-form-label mt-2" for="form-stacked-text">No. Dokumen Tindak Lanjut</label>
                        <div class="uk-form-controls">
                            <input class="uk-input " type="text"  [(ngModel)]="filterData.noDokumenTL" placeholder="Nomor Dokumen Tindak Lanjut">
                        </div>
                    </div>
    
                    <div class="col-md-6">
                        <label class="uk-form-label mt-2" for="form-stacked-text">Tanggal Approval - Dari</label>
                        <div class="uk-form-controls">
                            <input class="uk-input" type="date" placeholder="" [(ngModel)]="filterData.tglApprovalDari"  (change)="onDateChange(filterData.tglApprovalDari)">                        
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label class="uk-form-label mt-2" for="form-stacked-text">Tanggal Approval - Sampai</label>
                        <div class="uk-form-controls">
                            <input class="uk-input" type="date" placeholder="" [(ngModel)]="filterData.tglApprovalSampai"  (change)="onDateChange(filterData.tglApprovalSampai)">                        
                        </div>
                    </div>
    
                    <div class="col-md-6">
                        <label class="uk-form-label mt-2" for="form-stacked-text">KPA</label>
                        <div class="uk-form-controls">
                            <select class="uk-select" [(ngModel)]="filterData.idKpa" (change)="onKpaChange(filterData.idKpa)">
                                <option *ngFor="let kpa of ListKPA" [ngValue]="kpa.id">{{kpa.namaKpa}}</option>
                                <!-- <option [ngValue]="1">Dummy 100</option>
                                <option [ngValue]="2">Dummy 200</option>
                                <option [ngValue]="3">Dummy 300</option> -->
                            </select>                        
                        </div>
                    </div>


                    <div class="col-md-6">
                        <label class="uk-form-label mt-2" for="form-stacked-text">PPK</label>
                        <div class="uk-form-controls">
                            <select class="uk-select" [(ngModel)]="filterData.idPpk">
                                <option *ngFor="let ppk of ListPPK" [ngValue]="ppk.id" >{{ppk.namaPpk}}</option>
                                <!-- <option [ngValue]="1">Dummy PPK 100</option>
                                <option [ngValue]="2">Dummy PPK 200</option>
                                <option [ngValue]="3">Dummy PPK 300</option> -->
                            </select>                        
                        </div>
                    </div>
    
                    <div class="col-md-6"></div>
    
                    <div class="col-md-6 uk-flex uk-flex-right@m uk-flex-right@l uk-margin">
                        <button class="uk-button uk-button-default" (click)="doReset()">Reset</button>  &nbsp;
                        <button class="uk-button uk-button-primary" uk-icon="icon: search" (click)="doSearch(filterData)">Search </button>
                    </div> 
    
                    
    
    
                </div>
    
                 
               
            </div>
        </div>
    </div>
    
    


    <div class="">
        <div class="card mt-5">
          <div class="card-header card-header-primary">
            <h4 class="card-title">Approval Document</h4>
            <p class="card-category">New employees on 15th September, 2016</p>
          </div>


          <div class="p-5">
            <dx-data-grid 
                id="gridContainer"
                [dataSource]="ListApprovalDoc"
                [showBorders]="true"
                [allowColumnReordering]="true"
                [columnAutoWidth]="true"
                [allowColumnResizing]="true"
                >    

                <dxo-export [enabled]="true" fileName="Orders"></dxo-export>
                <dxo-column-chooser [enabled]="true" mode="select"></dxo-column-chooser>    
                <dxo-load-panel [enabled]="true"> </dxo-load-panel>
                <dxo-selection mode="multiple" selectAllMode="page">   <!-- or "allPages" --> </dxo-selection>
                <!-- <dxo-filter-row [visible]="true"></dxo-filter-row> -->
                <dxo-search-panel [visible]="true"></dxo-search-panel>
                <dxo-paging [pageSize]="5"></dxo-paging>
                <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20]" [showInfo]="true"> </dxo-pager>


                <dxi-column dataField="idKpa" caption="No. Dok. Approval" [allowSearch]="true" [visible]="false"></dxi-column>
                <dxi-column dataField="idPpk" caption="No. Dok. Approval" [allowSearch]="true" [visible]="false"></dxi-column>
                <dxi-column dataField="noDokumenApv" caption="No. Dok. Approval" [allowSearch]="true" [visible]="false"></dxi-column>
                <dxi-column dataField="namaDokumenApv" caption="No. Dok. Approval" [allowSearch]="true" [visible]="false"></dxi-column>
                <!-- <dxi-column dataField="noDokumen" caption="No. Dok. Approval" [allowSearch]="true" [visible]="false"></dxi-column> -->



                
                <dxi-column dataField="noDokumen" caption="No. Dok. Approval" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="namaDokumen" caption="Nama Dok. Approval" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="noDokumenTL" caption="No. Dok. Tindak Lanjut" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="tglDariBpk" caption="Tgl. Dokumen Masuk" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="tglKePpk" caption="Tgl. Dokumen Keluar" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="tglApproval" caption="Tgl. Approval" [allowSearch]="true"></dxi-column>

                <dxi-column dataField="namaKpa" caption="KPA" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="namaPpk" caption="PPK" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="nama" caption="User" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="status" caption="Status" [allowSearch]="true"></dxi-column>
                <dxi-column dataField="fileDokumen" caption="Dokumen" [allowSearch]="true" cellTemplate="downloadTemplate"></dxi-column>
                <dxi-column dataField="id" caption="Action" alignment="center" [width]="100" cellTemplate="actionTemplate"></dxi-column>
                    <div *dxTemplate="let cell of 'actionTemplate'">

                        <div class="uk-flex uk-flex-center@m uk-flex-center@l uk-text-middle">
                            <a (click)="modalDelete(cell);" uk-toggle uk-icon="icon: close" ></a> &nbsp;
                            <a (click)="onEditClick(cell);" uk-icon="icon: pencil"></a> &nbsp;  
                        </div> 
                            
                    </div>

                    <div *dxTemplate="let cell of 'downloadTemplate'">

                        <div class="uk-flex uk-flex-center@m uk-flex-center@l uk-text-middle">
                            <a (click)="onDownloadClick(cell.data);" class="uk-link-text uk-text-primary">Download</a> &nbsp;                            
                            
                        </div> 
                        
                    </div>



            </dx-data-grid>
          </div>
          

          
        </div>
      </div>


</section >

<section [hidden]="windowMode == 'grid'">

    <form class="uk-form-horizontal uk-margin-large" [formGroup]="approvalForm" (ngSubmit)="onSubmit()" >

        <div class="uk-flex uk-flex-right@m uk-flex-right@l uk-text-middle uk-margin">
            <a class="uk-button uk-button-default" (click)="windowModeView('grid')">Back</a> &nbsp;
            <button type="submit"  class="uk-button uk-button-primary">
                <span *ngIf="windowMode=='create'">Save</span>
                <span *ngIf="windowMode=='edit'">Update</span>
            </button>
        </div>  


        <div class="card">
            <div class="card-body m-5">

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-select">No. Dokumen Tindak Lanjut</label>
                    <div class="uk-form-controls">
                        <select class="uk-select" [(ngModel)]="modelApprovalDoc.idTindakLanjut" formControlName="idTindakLanjut" (change)="onDocumentNumberChanged(modelApprovalDoc.idTindakLanjut)" [ngClass]="{ 'uk-form-danger': submitted && f.idTindakLanjut.errors }">
                            <option *ngFor="let data of ListTindakLanjut" [ngValue]="data.id">{{data.noDokumen}}</option>


                            <option [ngValue]="1">Dummy 100</option>
                            <option [ngValue]="2">Dummy 200</option>
                            <option [ngValue]="3">Dummy 300</option>
                        </select>
            
                        <div *ngIf="submitted && f.idTindakLanjut.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.idTindakLanjut.errors.required">No. Dokumen Tindak Lanjut wajib diisi</div>
                        </div>
            
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">No. Dokumen Approval </label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="text" placeholder="Masukan Nama..." formControlName="noDokumenApv" [ngClass]="{ 'uk-form-danger': submitted && f.noDokumenApv.errors }">
                        <div *ngIf="submitted && f.noDokumenApv.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.noDokumenApv.errors.required">No. Dokumen Approval wajib diisi</div>
                        </div>
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Nama Dokumen Approval</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="text" placeholder="Masukan Nama..." formControlName="namaDokumenApv" [ngClass]="{ 'uk-form-danger': submitted && f.namaDokumenApv.errors }">
                        <div *ngIf="submitted && f.namaDokumenApv.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.namaDokumenApv.errors.required">Nama Dokumen wajib diisi</div>
                        </div>
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">No. Dokumen Tindak Lanjut</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="text" placeholder="Nomor Dokumen Tindak Lanjut..." formControlName="noDokumen" disabled="true" [ngClass]="{ 'uk-form-danger': submitted && f.noDokumen.errors }">
                        <div *ngIf="submitted && f.noDokumen.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.noDokumen.errors.required">No. Dokumen wajib diisi</div>
                        </div>
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-select">KPA</label>
                    <div class="uk-form-controls">
                        <select class="uk-select" [(ngModel)]="modelApprovalDoc.idKpa" disabled="true" formControlName="idKpa" (change)="onKpaChange(modelApprovalDoc.idKpa)" [ngClass]="{ 'uk-form-danger': submitted && f.idKpa.errors }">
                            <option *ngFor="let kpa of ListKPA" [ngValue]="kpa.id">{{kpa.namaKpa}}</option>
                            <!-- <option [ngValue]="1">Dummy 100</option>
                            <option [ngValue]="2">Dummy 200</option>
                            <option [ngValue]="3">Dummy 300</option> -->
                        </select>
            
                        <div *ngIf="submitted && f.idKpa.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.idKpa.errors.required">KPA wajib diisi</div>
                        </div>
            
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-select">PPK</label>
                    <div class="uk-form-controls">
                        <select class="uk-select" [(ngModel)]="modelApprovalDoc.idPpk" disabled="true" formControlName="idPpk" [ngClass]="{ 'uk-form-danger': submitted && f.idPpk.errors }">
                            <option *ngFor="let ppk of ListPPK" [ngValue]="ppk.id">{{ppk.namaPpk}}</option>
                            <!-- <option [ngValue]="1">Dummy PPK 100</option>
                            <option [ngValue]="2">Dummy PPK 200</option>
                            <option [ngValue]="3">Dummy PPK 300</option> -->
                        </select>
            
                        <div *ngIf="submitted && f.idPpk.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.idPpk.errors.required">PPK wajib diisi</div>
                        </div>
            
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Tgl. Dokumen Approval</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="date" placeholder="Masukan Nama..." formControlName="tglApproval"   [(ngModel)]="modelApprovalDoc.tglApproval"
                                [ngClass]="{ 'uk-form-danger': submitted && f.tglApproval.errors }" (change)="onDateChange(modelApprovalDoc.tglApproval)">
                        <div *ngIf="submitted && f.tglApproval.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.tglApproval.errors.required">Tgl. Dokumen Approval wajib diisi</div>
                        </div>
                    </div>
                </div>
               
            
                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Tgl. Dokumen Tindak Lanjut Dari BPK</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="date" placeholder="Masukan Nama..." disabled="true" formControlName="tglDariBpk" [(ngModel)]="modelApprovalDoc.tglDariBpk"
                                [ngClass]="{ 'uk-form-danger': submitted && f.tglDariBpk.errors }" (change)="onDateChange(modelApprovalDoc.tglDariBpk)">
                        <div *ngIf="submitted && f.tglDariBpk.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.tglDariBpk.errors.required">Tgl. Dokumen Tindak Lanjut Dari BPK wajib diisi</div>
                        </div>
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Tgl. Dokumen Tindak Lanjut Ke PPK</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="date" placeholder="Masukan Nama..." disabled="true" formControlName="tglKePpk"   [(ngModel)]="modelApprovalDoc.tglKePpk"
                                [ngClass]="{ 'uk-form-danger': submitted && f.tglKePpk.errors }" (change)="onDateChange(modelApprovalDoc.tglKePpk)">
                        <div *ngIf="submitted && f.tglKePpk.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.tglKePpk.errors.required">Tgl. Dokumen Tindak Lanjut Ke PPK wajib diisi</div>
                        </div>
                    </div>
                </div>


                <!-- <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">File Dokumen</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="File" (change)="handleFileInput($event.target.files)" placeholder="Masukan Username..." formControlName="fileDokumen" [ngClass]="{ 'uk-form-danger': submitted && f.fileDokumen.errors }">
                        <div *ngIf="submitted && f.fileDokumen.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.fileDokumen.errors.required">File Dokumen wajib diisi</div>
                        </div>
                    </div>
                </div> -->

                <div class="uk-margin" *ngIf="windowMode == 'create'">
                    <label class="uk-form-label" for="form-horizontal-text">File Dokumen</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" type="File" (change)="handleFileInput($event.target.files)" placeholder="Masukan Username..." formControlName="fileDokumen" [ngClass]="{ 'uk-form-danger': submitted && f.fileDokumen.errors }">
                        <div *ngIf="submitted && f.fileDokumen.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.fileDokumen.errors.required">File Dokumen wajib diisi</div>
                        </div>
                    </div>
                </div>


                <div class="uk-margin" *ngIf="windowMode != 'create' && !isShowFormUpload">
                    <label class="uk-form-label" for="form-horizontal-text">Download Dokumen</label>
                    <div class="uk-form-controls">

                        <div class="uk-inline" style="min-width: 100%;">
                            <button class="uk-button uk-button-default uk-width-1-1" type="button" >{{namafile}}</button>
                            <div uk-dropdown>
                                <ul class="uk-nav uk-dropdown-nav">
                                    <li><a  (click)="onDownloadClick(modelApprovalDoc)">Download File</a></li>
                                    <li><a (click)="toggleUploadFile(1)" >Upload File Baru</a></li>
                                </ul>
                            </div>
                        </div>
                        
                    </div>
                </div>

                <div class="uk-margin" *ngIf="isShowFormUpload">
                    <label class="uk-form-label" for="form-horizontal-text">File Dokumen</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <a class="uk-form-icon uk-form-icon-flip" (click)="toggleUploadFile(0)" uk-icon="icon: close"></a>
                            <input class="uk-input" type="File" (change)="handleFileInput($event.target.files)" placeholder="Masukan Username..." formControlName="fileDokumen" [ngClass]="{ 'uk-form-danger': submitted && f.fileDokumen.errors }">
                        </div>


                        <div *ngIf="submitted && f.fileDokumen.errors" class="uk-text-danger uk-text-italic">
                            <div *ngIf="f.fileDokumen.errors.required">File Dokumen wajib diisi</div>
                        </div>
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Catatan</label>
                    <div class="uk-form-controls">
                        <textarea class="uk-textarea" type="text" rows="5" placeholder="Masukan Catatan..." formControlName="catatan"></textarea>
                        
                    </div> 
                </div>



            </div>
        </div>



                        

                       

                      
   


    </form>
        



</section>



<!-- modal-delete-approvaldoc -->
<div id="modal-delete-approvaldoc" class="uk-flex-top" uk-modal>    
    <div class="uk-modal-dialog uk-margin-auto-vertical uk-modal-body">
        <h2 class="uk-modal-title">Hapus data?</h2>
        <p>Apakah anda yakin ingin menghapus data  <span style="font-weight: bold;">{{deleteDataApprovalDoc}}</span> </p>
        <p class="uk-text-right">
            <button class="uk-button uk-button-default uk-modal-close" type="button">Batal</button> &nbsp;
            <button class="uk-button uk-button-primary" (click)="doDelete()" type="button">Hapus</button>
        </p>
    </div>
</div>
<!-- modal-delete-approvaldoc -->
